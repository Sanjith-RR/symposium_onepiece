"use client";

import { useRouter } from "next/navigation"; // Import useRouter from next/router
import { useEffect, useState } from "react";
import { FaDownload, FaPaperPlane } from "react-icons/fa";

export default function Home() {
  const [timeLeft, setTimeLeft] = useState(0); // 25 minutes in seconds
  const [secretCode, setSecretCode] = useState(""); // State for the secret code
  const router = useRouter(); // Initialize the router

  useEffect(() => {
    const timer = setInterval(() => {
      setTimeLeft((prevTime) => {
        if (prevTime > 0) {
          return prevTime - 1;
        } else {
          clearInterval(timer); // Stop the timer when time reaches zero
          return 0;
        }
      });
    }, 1000);

    return () => clearInterval(timer);
  }, []);

  useEffect(() => {
    // Check if there's a start time in localStorage
    const storedStartTime = localStorage.getItem('startTime_1');
    const storedDuration = localStorage.getItem('duration_1') || (25 * 60).toString();

    if (storedStartTime) {
      const elapsedTime = Math.floor((Date.now() - parseInt(storedStartTime)) / 1000);
      const remainingTime = Math.max(parseInt(storedDuration) - elapsedTime, 0);
      setTimeLeft(remainingTime);
    } else {
      const newStartTime = Date.now(); // new Date('2024-03-16T10:00:00').getTime();
      localStorage.setItem('startTime_1', newStartTime.toString());
      localStorage.setItem('duration_1', storedDuration.toString());
      setTimeLeft(parseInt(storedDuration));
    }
  }, []);

  const handleDataset = ()=>{
    const url = "https://github.com/Sandhiya-S67/symposium_dataset";
    window.open(url, "_blank", "noopener,noreferrer");
  }

  const formatTime = (seconds: number) => {
    const minutes = Math.floor(seconds / 60);
    const remainingSeconds = seconds % 60;
    return `${String(minutes).padStart(2, "0")}:${String(remainingSeconds).padStart(2, "0")}`;
  };

  const calculateMatchPercentage = (input: string, target: string) => {
    let matchCount = 0;
    for (let i = 0; i < Math.min(input.length, target.length); i++) {
      if (input[i] === target[i]) {
        matchCount++;
      }
    }
    return (matchCount / target.length) * 100;
  };

  const handleSubmit = () => {
    const targetCode = "304770203099004300574403603300004150370125506006402549104202030010603001000030922030000027000602200070000030004100003040402211090020320030000731950038484300101100568004140202902073100748375220030926040640979002020003529009100106000754643001206683576511133025040003201309009300036750323440600042400000050582460590031040407827093903000310020200805432039400402000403500140094041340022205101000037020331603040002633090904300934131022002904044032000152210300346045080400001038046400017167043012590220000002770000390032531040043000745063000014001935400052226009715905300025052010906505360040402099000410010040030006009200080002716518320005911070020010320090034500607080309452050130065943030301798003000100009403619060116081103393400200003200056103419001705003990704924200999000050063699000000063509901005700050003104004328700273010040001109825379210071070010030992947400988999504090536240060001392030300130060130200944042138032000031200835209001200005305619100202004270060803257020930086303030000000807000011240503093063004430043000403404016223059031200090550040815000410039419324007426100200000930000000050080006962504402504101330414100250730000444390120006033322743020694983703370835831293626000015395910490813691005000760000321400000304097000000000200060153060101305095082001013001040104161500393802000005400150500730040602042401024002110700043103010001001020100960340112516001513260028300300000380031006008403223420200074050200070700010012500001049040002350012290020040004103035368020310021102300420410304970000007003030490110106470003060209000090000000001000957000008632160310016696004000129100098030019401002510003130006000106802520960010060104003103004040232901306280100040930900024054804010102340310001000000002787063020069250000005014270452000820000385403004553403000020531065069071331115451130305020010002070000070360029004731009991450202090404511483100246100305318000600001341000540250601404404004020993160141010200200040105100790790147207141804094005009023000580310001000000133032570909081000330009104490325102026009090035635005003060043004300002149000080051024006031007113090000246040801000010903100006239201040314052305014900250747470160300064000671513003295000300050003000003300430510003044000010503011000492040194019033000930305304036086661001406061040001695422910000524230057290190001330000029080352030018920096343333114011007569000544005944301366202020032825011090002100442823003003726056503603300002120310045001640300002190003100409005394000590029386467000063370030021102005091700900430593042090310460027040400901016000602109210000622000120200000140916074300000104002075470383041354527290371321550030400403022312080004900008971002231465346930900005243232011009001401101690790501053002000004006010020390410945003040820349071030332300370430040062306100060409300024401001320032072123009170603303005400727204006048102101050311000701000019504509230042770120405291765034770000602006020048341090100913526944090830000500618009041401270262001001101309000100300307501903010703070072010460529000020900303610007040000319110001201160190300500350300556700064481630193000420510002804029900050010019740638540002000220000371331441040090320751000011190011004040130023044045900065904304030031007010440033024068406006130400004100027095161409050096500005046100609233600001900006000249004000414230301012031421440229010510600030341000030300500425400025020704900046100820023700012000500034017501051401090036303000037454801114008008003070900003515530081103960645000033050030400228505190111000130330352302400130003065228330044000900525112012010700520200930730801000934770010001510000008067109440003404300006190011730010480094007301000216904405200625410825030000300001323000523050900420442031295000035600091420000092390022000110450113950079433040010300090043030004000501304045002000814060030324171008267010101213245002000722100578932200074800101243106000000918866300094009400908342270105030100001710303022511022106067102993000082114000300000000194014303023521000070060034152380900051123210679080012609003430002062903400040121041914232453252009125300037000490068050704740410403100424000020215140511504071170442400041962601300902609500040649900005500300050002935000230203005400700042000049013203900000981004631579259030170032966504451200807000006110209030064030126600109161050900000220300230261240050002204000600009600010900000100100940000410130118020503300000075010003008109400042090109550700410050932364001400302000000730040494004001900250009039209002504504191003005000000103040338095007315000310402000240030101110500622102000690002130200930100102051000300390252000001210501360300029000222320201070572330090010002551014405300336143448309500049190001000916038000202340537333744351060209131040207700003030200000000933003041001105710334020010510364035400600202000801484000406250100926090901391600504908950030010350040080900096271037010070405255200060176400260000460432906001004500054020404008303000042352254020050230010020000001303040015002336040000032900005117028683015007013328090203400072462200070573903301108220307200804100904040140004000666290409509013090043090000001974015010008620093020000530214510400012900001544015906000501039017000000712904486300520413700270051034515001261974020050430000260079520091510009229434200900294040109008500032301600010266140097373003090000301022700050692000095643060100096024318063000909430150310942106912300002150045701052000040542719413304008506900000830040102100157009000039007110403456066405003040006090804560003301036400404005100309820014900819060540009950440200042803505700110107100000510510203300001000010134212081044592016404110965020320030010130406104064005410008038315030359500801804520290046730870010300005302431005000123070000611008023040030004205200308375820644608081000200000551300482010060091493399020160621069020195603380040110002030050002004500501947036341392337043433756000057100602000285040900110060390066060900630064040413945443022009130000004121470030367480004440252240200044300810200700401540400000907671000000000100500200344900937540035046920075140100103511000000001010004371024843375315007312906090302509040084153194313043503622370935040500063420720030470900402700500907074000002050095100703000004039200160204109099921390040500101019902931001540174000314081551004006001000905000003002190002045000300006027020930064460061209704050126000000600390152012530062001440492000188306343003000305230007002114000000010109417402046401179001482050304000101000130300002426303000000020095000900400184303900004036002000303937910440211350124";
    const matchPercentage = calculateMatchPercentage(secretCode.trim(), targetCode);

    if (matchPercentage >= 75) {
      localStorage.setItem("access_granted_2", "true"); // Set access_granted to true
      router.push("/level_two"); // Redirect to /level_two
    } else {
      setSecretCode(""); // Clear the input field
      alert(`Wrong Secret Code. Your input is ${matchPercentage.toFixed(2)}% similar to the target code. Try Again!`); // Show alert
    }
  };

  const handleKeyPress = (event: React.KeyboardEvent<HTMLInputElement>) => {
    if (event.key === "Enter") {
      handleSubmit();
    }
  };

  return (
    <div className="w-screen h-screen overflow-hidden">
      {/* Header */}
      <div
        className="w-full flex justify-center items-center"
        style={{ backgroundColor: "#8A7D63", height: "20vh" }}
      >
        <h1 className="text-black text-8xl font-bold">Level One</h1>
      </div>

      {/* Body with Background Image */}
      <div
        className="h-full w-full bg-cover bg-center flex flex-col justify-start items-start"
        style={{
          backgroundImage: "url('/images/treasure1.jpg')",
          paddingTop: "10vh",
          opacity: "0.8",
        }}
      >
        {/* Container with GIF and Countdown */}
        <div
          className="flex flex-row items-center"
          style={{
            width: "34.2vh",
            height: "12.1vh",
            backgroundColor: "#B29B6A",
            marginTop: "7vh",
            marginLeft: "10vh",
            padding: "0.5rem",
            overflow: "hidden", // Ensure nothing leaks outside
          }}
        >
          <iframe
            src="https://tenor.com/embed/14056873221910130729"
            className="border-0"
            style={{
              borderRadius: "10px",
              width: "50%",
              height: "100%",
            }}
            allowFullScreen
          ></iframe>
          <div className="ml-4 text-black text-xl font-semibold">
            <div className="flex flex-col">
              <span>Time Left:</span>
              <span>{formatTime(timeLeft)}</span>
            </div>
          </div>
        </div>

        {/* Secret Code Input */}
        <div
          className="flex flex-col items-start"
          style={{
            marginTop: "5vh",
            width: "50%",
            backgroundColor: "#B29B6A",
            padding: "1rem",
            borderRadius: "5px",
            marginLeft: "10vh",
          }}
        >
          <div className="text-black text-xl font-semibold mb-2">
            Enter The Secret Code:
          </div>
          <div className="flex items-center w-full">
            <input
              type="text"
              placeholder="eg: 13482938"
              className="p-2 text-black text-left"
              style={{
                width: "100%",
                borderRadius: "5px",
                border: "1px solid #B29B6A",
              }}
              value={secretCode}
              onChange={(e) => setSecretCode(e.target.value)}
              onKeyPress={handleKeyPress} // Add onKeyPress event
              disabled={timeLeft === 0} // Disable input when time is up
            />
            <button
              className="ml-2 p-2 text-white bg-blue-500 rounded"
              style={{ borderRadius: "5px" }}
              onClick={handleSubmit} // Add onClick event
              disabled={timeLeft === 0} // Disable button when time is up
            >
              <FaPaperPlane />
            </button>
          </div>
        </div>

        {/* Download Button Container */}
        <div
          className="flex items-center hover:shadow-lg hover:shadow-yellow-500 transition-shadow duration-300"
          style={{
            marginTop: "15vh",
            width: "15%",
            backgroundColor: "#B29B6A",
            padding: "1rem",
            borderRadius: "5px",
            marginLeft: "10vh",
          }}
        >
          <FaDownload className="text-black mr-2 hover:text-yellow-500 transition-colors duration-300" />
          <button className="text-black text-xl font-semibold hover:text-yellow-500 transition-colors duration-300" onClick={handleDataset}>
            Download Dataset
          </button>
        </div>
      </div>
    </div>
  );
}
